# ğŸš€ Web3 è¯¾ç¨‹å¹³å° - åç«¯å¼€å‘å®ŒæˆæŠ¥å‘Š

## ğŸ“… å¼€å‘æ—¶é—´
**2025å¹´1æœˆ9æ—¥** - åç«¯å¼€å‘å®Œæˆ

## âœ… å®Œæˆçš„åŠŸèƒ½æ¨¡å—

### 1. ğŸ—ï¸ åç«¯åŸºç¡€æ¶æ„ 

#### é¡¹ç›®æ­å»º âœ…
```bash
# æŠ€æœ¯æ ˆ
- Node.js + Express.js
- TypeScript (å®Œæ•´ç±»å‹æ”¯æŒ)
- MySQL2 (è¿æ¥æ± )
- Docker (æ•°æ®åº“å®¹å™¨åŒ–)
- PNPM (åŒ…ç®¡ç†å™¨)
```

#### å¼€å‘å·¥å…·é…ç½® âœ…
- **nodemon**: çƒ­é‡è½½å¼€å‘
- **ts-node**: TypeScript è¿è¡Œæ—¶
- **dotenv**: ç¯å¢ƒå˜é‡ç®¡ç†
- **CORS**: è·¨åŸŸèµ„æºå…±äº«é…ç½®

#### é¡¹ç›®ç»“æ„ âœ…
```
backend/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ server.ts          # ä¸»æœåŠ¡å™¨æ–‡ä»¶
â”‚   â”œâ”€â”€ database.ts        # æ•°æ®åº“è¿æ¥é…ç½®
â”‚   â””â”€â”€ routes/
â”‚       â”œâ”€â”€ courses.ts     # è¯¾ç¨‹ç›¸å…³è·¯ç”±
â”‚       â”œâ”€â”€ users.ts       # ç”¨æˆ·ç›¸å…³è·¯ç”±
â”‚       â””â”€â”€ purchases.ts   # è´­ä¹°è®°å½•è·¯ç”±
â”œâ”€â”€ docker-compose.yml     # MySQL å®¹å™¨é…ç½®
â”œâ”€â”€ package.json          # é¡¹ç›®ä¾èµ–
â”œâ”€â”€ tsconfig.json         # TypeScript é…ç½®
â””â”€â”€ .env                  # ç¯å¢ƒå˜é‡
```

### 2. ğŸ—„ï¸ æ•°æ®åº“è®¾è®¡ä¸å®ç°

#### MySQL æ•°æ®åº“éƒ¨ç½² âœ…
```yaml
# Docker Compose é…ç½®
services:
  mysql:
    image: mysql:8.0
    container_name: web3_course_db
    ports: 
      - "3306:3306"
    environment:
      MYSQL_ROOT_PASSWORD: root123
      MYSQL_DATABASE: web3_course_platform
      MYSQL_USER: app_user
      MYSQL_PASSWORD: app_pass123
    volumes:
      - mysql_data:/var/lib/mysql
```

#### æ•°æ®è¡¨åˆ›å»º âœ…
```sql
-- 1. ç”¨æˆ·è¡¨
CREATE TABLE users (
  id BIGINT PRIMARY KEY AUTO_INCREMENT,
  wallet_address VARCHAR(42) UNIQUE NOT NULL,
  nickname VARCHAR(50),
  bio TEXT,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  INDEX idx_wallet (wallet_address)
);

-- 2. è¯¾ç¨‹è¡¨
CREATE TABLE courses (
  id BIGINT PRIMARY KEY AUTO_INCREMENT,
  course_id VARCHAR(50) NOT NULL,
  instructor_address VARCHAR(42) NOT NULL,
  title VARCHAR(200) NOT NULL,
  description TEXT,
  price_yd DECIMAL(18,8) NOT NULL,
  tx_hash VARCHAR(66),
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  INDEX idx_instructor (instructor_address),
  INDEX idx_course_id (course_id)
);

-- 3. è´­ä¹°è®°å½•è¡¨
CREATE TABLE purchases (
  id BIGINT PRIMARY KEY AUTO_INCREMENT,
  user_address VARCHAR(42) NOT NULL,
  course_id VARCHAR(50) NOT NULL,
  tx_hash VARCHAR(66) NOT NULL,
  price_paid DECIMAL(18,8),
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  INDEX idx_user_course (user_address, course_id)
);
```

#### æ•°æ®åº“è¿æ¥æ± é…ç½® âœ…
```typescript
// è¿æ¥æ± é…ç½®
export const pool = mysql.createPool({
  host: process.env.DB_HOST || 'localhost',
  port: parseInt(process.env.DB_PORT || '3306'),
  user: process.env.DB_USER || 'app_user',
  password: process.env.DB_PASSWORD || 'app_pass123',
  database: process.env.DB_NAME || 'web3_course_platform',
  waitForConnections: true,
  connectionLimit: 10,
  queueLimit: 0,
});
```

### 3. ğŸ”Œ å®Œæ•´çš„ REST API æ¥å£

#### è¯¾ç¨‹ç›¸å…³ API âœ…
```typescript
// GET /api/courses - è·å–è¯¾ç¨‹åˆ—è¡¨(åˆ†é¡µ)
// è¿”å›æ ¼å¼:
{
  "success": true,
  "data": {
    "courses": [...],
    "pagination": {
      "page": 1,
      "limit": 10,
      "total": 100,
      "totalPages": 10
    }
  }
}

// POST /api/courses - åˆ›å»ºè¯¾ç¨‹
// è¯·æ±‚å‚æ•°: { courseId, title, description, price, instructorAddress, txHash }
// åŠŸèƒ½: æ™ºèƒ½åˆçº¦åˆ›å»ºè¯¾ç¨‹ååŒæ­¥åˆ°æ•°æ®åº“

// POST /api/courses/:courseId/details - è·å–è¯¾ç¨‹è¯¦æƒ…
// éœ€è¦ç­¾åéªŒè¯: { userAddress, signature, timestamp }
// éªŒè¯ç”¨æˆ·è´­ä¹°çŠ¶æ€ï¼Œè¿”å›è¯¾ç¨‹è¯¦ç»†å†…å®¹
```

#### ç”¨æˆ·ç›¸å…³ API âœ…
```typescript
// GET /api/users/:address - è·å–ç”¨æˆ·ä¿¡æ¯
// åŠŸèƒ½: è‡ªåŠ¨åˆ›å»ºæ–°ç”¨æˆ·ï¼Œè¿”å›ç”¨æˆ·èµ„æ–™

// POST /api/users/profile - æ›´æ–°ç”¨æˆ·èµ„æ–™
// éœ€è¦ç­¾åéªŒè¯: { userAddress, nickname, bio, signature, timestamp }
// éªŒè¯ç­¾åæœ‰æ•ˆæœŸï¼š5åˆ†é’Ÿå†…
```

#### è´­ä¹°è®°å½• API âœ…
```typescript
// POST /api/purchases - è®°å½•è´­ä¹°
// è¯·æ±‚å‚æ•°: { userAddress, courseId, txHash, pricePaid }
// åŠŸèƒ½: æ™ºèƒ½åˆçº¦è´­ä¹°ååŒæ­¥è´­ä¹°è®°å½•

// GET /api/purchases/user/:address - è·å–ç”¨æˆ·è´­ä¹°è®°å½•
// è¿”å›: ç”¨æˆ·æ‰€æœ‰è´­ä¹°è¯¾ç¨‹ï¼ŒåŒ…å«è¯¾ç¨‹è¯¦ç»†ä¿¡æ¯
```

#### å·¥å…·ç±» API âœ…
```typescript
// GET /api/test - æµ‹è¯•è¿æ¥
// GET /api/health - å¥åº·æ£€æŸ¥
// GET / - æœåŠ¡å™¨çŠ¶æ€
```

### 4. ğŸ” å®‰å…¨æœºåˆ¶å®ç°

#### ç­¾åéªŒè¯ âœ…
```typescript
// æ—¶é—´æˆ³éªŒè¯ï¼ˆ5åˆ†é’Ÿæœ‰æ•ˆæœŸï¼‰
const now = Math.floor(Date.now() / 1000);
if (Math.abs(now - timestamp) > 300) {
  return res.status(400).json({
    success: false,
    error: 'ç­¾åå·²è¿‡æœŸ'
  });
}

// TODO: å®Œæ•´çš„ç­¾åéªŒè¯é€»è¾‘ï¼ˆå¾…å®ç°ï¼‰
// const verifySignature = (message, signature, address) => {
//   const recoveredAddress = ethers.verifyMessage(message, signature);
//   return recoveredAddress.toLowerCase() === address.toLowerCase();
// };
```

#### CORS é…ç½® âœ…
```typescript
app.use(cors({
  origin: process.env.FRONTEND_URL || 'http://localhost:5173',
  credentials: true
}));
```

#### é”™è¯¯å¤„ç† âœ…
```typescript
// ç»Ÿä¸€é”™è¯¯å¤„ç†æ ¼å¼
try {
  // ä¸šåŠ¡é€»è¾‘
} catch (error) {
  console.error('æ“ä½œå¤±è´¥:', error);
  res.status(500).json({
    success: false,
    error: 'æ“ä½œå¤±è´¥'
  });
}
```

### 5. ğŸ”— å‰åç«¯é›†æˆ

#### å‰ç«¯ API æœåŠ¡å±‚ âœ…
```typescript
// /frontend/src/services/api.ts
class ApiService {
  private async request<T>(url: string, options: RequestInit = {}) {
    // ç»Ÿä¸€çš„è¯·æ±‚å°è£…
    // é”™è¯¯å¤„ç†å’Œå“åº”æ ¼å¼åŒ–
  }
  
  async get<T>(url: string): Promise<ApiResponse<T>>
  async post<T>(url: string, data?: unknown): Promise<ApiResponse<T>>
  async put<T>(url: string, data?: unknown): Promise<ApiResponse<T>>
  async delete<T>(url: string): Promise<ApiResponse<T>>
}

// å…·ä½“APIè°ƒç”¨å°è£…
export const courseApi = { ... }
export const userApi = { ... }
export const purchaseApi = { ... }
export const testApi = { ... }
```

#### æ™ºèƒ½åˆçº¦ä¸åç«¯åŒå†™ âœ…
```typescript
// useContracts.ts ä¸­çš„é›†æˆé€»è¾‘
const createCourse = async (title, description, price) => {
  // 1. è°ƒç”¨æ™ºèƒ½åˆçº¦åˆ›å»ºè¯¾ç¨‹
  const tx = await contract.createCourse(title, description, priceWei);
  const receipt = await tx.wait();
  
  // 2. ä»äº‹ä»¶ä¸­è·å–è¯¾ç¨‹ID
  const courseId = parsed.args.courseId.toString();

  // 3. åŒæ­¥åˆ°åç«¯æ•°æ®åº“
  await courseApi.createCourse({
    courseId, title, description, price,
    instructorAddress: account, txHash: tx.hash
  });
};

// è´­ä¹°è¯¾ç¨‹çš„åŒå†™é€»è¾‘
const purchaseCourse = async (courseId: number) => {
  // 1. æ™ºèƒ½åˆçº¦è´­ä¹°
  const tx = await contract.purchaseCourse(courseId);
  await tx.wait();

  // 2. åŒæ­¥è´­ä¹°è®°å½•åˆ°æ•°æ®åº“
  await purchaseApi.recordPurchase({
    userAddress: account, courseId: courseId.toString(),
    txHash: tx.hash, pricePaid: priceInEther
  });
};
```

#### æ•°æ®è·å–ç­–ç•¥ âœ…
```typescript
// ä¼˜å…ˆä»åç«¯APIè·å–ï¼Œå¤±è´¥æ—¶é™çº§åˆ°åŒºå—é“¾
const getCoursesFromAPI = async () => {
  try {
    const response = await courseApi.getCourses(1, 50);
    return response.data.courses.map(formatCourse);
  } catch (error) {
    console.error('ä»APIè·å–è¯¾ç¨‹å¤±è´¥:', error);
    // é™çº§åˆ°åŒºå—é“¾è·å–
    return await courseOperations.getAllCourses();
  }
};
```

## ğŸ§ª å®Œæ•´ç³»ç»Ÿæµ‹è¯•

### æµ‹è¯•ç¯å¢ƒ âœ…
- **åç«¯æœåŠ¡å™¨**: http://localhost:3001 âœ…
- **å‰ç«¯åº”ç”¨**: http://localhost:5176 âœ…  
- **MySQLæ•°æ®åº“**: localhost:3306 âœ…
- **è·¨åŸŸé€šä¿¡**: CORSé…ç½®æ­£ç¡® âœ…

### API æ¥å£æµ‹è¯• âœ…

#### 1. è¯¾ç¨‹ç®¡ç†æµ‹è¯•
```bash
# è·å–è¯¾ç¨‹åˆ—è¡¨
curl http://localhost:3001/api/courses
# è¿”å›: {"success":true,"data":{"courses":[...],"pagination":{...}}}

# åˆ›å»ºè¯¾ç¨‹
curl -X POST -H "Content-Type: application/json" \
  -d '{"courseId":"course-001","title":"åŒºå—é“¾åŸºç¡€æ•™ç¨‹",...}' \
  http://localhost:3001/api/courses
# è¿”å›: {"success":true,"message":"è¯¾ç¨‹åˆ›å»ºæˆåŠŸ","data":{"id":1,"courseId":"course-001"}}
```

#### 2. ç”¨æˆ·ç®¡ç†æµ‹è¯•
```bash
# è·å–ç”¨æˆ·ä¿¡æ¯ï¼ˆè‡ªåŠ¨åˆ›å»ºï¼‰
curl http://localhost:3001/api/users/0x1234567890123456789012345678901234567890
# è¿”å›: {"success":true,"data":{"id":1,"wallet_address":"0x..."}}
```

#### 3. è´­ä¹°è®°å½•æµ‹è¯•
```bash
# è®°å½•è´­ä¹°
curl -X POST -H "Content-Type: application/json" \
  -d '{"userAddress":"0x...","courseId":"course-001","txHash":"0x...","pricePaid":"100"}' \
  http://localhost:3001/api/purchases
# è¿”å›: {"success":true,"message":"è´­ä¹°è®°å½•æˆåŠŸ"}

# è·å–ç”¨æˆ·è´­ä¹°è®°å½•
curl http://localhost:3001/api/purchases/user/0x1234567890123456789012345678901234567890
# è¿”å›: åŒ…å«è¯¾ç¨‹ä¿¡æ¯çš„è´­ä¹°è®°å½•åˆ—è¡¨
```

### æ•°æ®ä¸€è‡´æ€§éªŒè¯ âœ…
- **è¯¾ç¨‹æ•°æ®**: æ™ºèƒ½åˆçº¦åˆ›å»º â†’ è‡ªåŠ¨åŒæ­¥åˆ°æ•°æ®åº“ âœ…
- **è´­ä¹°è®°å½•**: åŒºå—é“¾è´­ä¹° â†’ è‡ªåŠ¨è®°å½•åˆ°æ•°æ®åº“ âœ…
- **ç”¨æˆ·ä¿¡æ¯**: é’±åŒ…åœ°å€ â†’ è‡ªåŠ¨åˆ›å»ºç”¨æˆ·è®°å½• âœ…

## ğŸ“Š æ€§èƒ½ä¸ä¼˜åŒ–

### æ•°æ®åº“ä¼˜åŒ– âœ…
- **ç´¢å¼•åˆ›å»º**: wallet_address, instructor_address, course_id
- **è¿æ¥æ± **: æœ€å¤§10ä¸ªè¿æ¥ï¼Œé¿å…è¿æ¥æ³„æ¼
- **æŸ¥è¯¢ä¼˜åŒ–**: åˆ†é¡µæŸ¥è¯¢é¿å…å…¨è¡¨æ‰«æ

### API æ€§èƒ½ âœ…
- **é™çº§ç­–ç•¥**: APIå¤±è´¥æ—¶è‡ªåŠ¨ä½¿ç”¨åŒºå—é“¾æ•°æ®
- **é”™è¯¯å¤„ç†**: ç»Ÿä¸€çš„é”™è¯¯æ ¼å¼å’Œæ—¥å¿—è®°å½•
- **å¹¶å‘å¤„ç†**: Expresså¼‚æ­¥å¤„ç†ï¼Œæ”¯æŒå¤šç”¨æˆ·åŒæ—¶æ“ä½œ

## ğŸ”® åç»­ä¼˜åŒ–è®¡åˆ’

### å¾…å®ç°åŠŸèƒ½
1. **å®Œæ•´ç­¾åéªŒè¯**: ethers.js verifyMessage å®ç°
2. **ç¼“å­˜æœºåˆ¶**: Redisç¼“å­˜çƒ­é—¨è¯¾ç¨‹æ•°æ®
3. **æ—¥å¿—ç³»ç»Ÿ**: Winston æ—¥å¿—è®°å½•
4. **APIé™æµ**: é˜²æ­¢æ¶æ„è¯·æ±‚
5. **æ•°æ®å¤‡ä»½**: å®šæœŸæ•°æ®åº“å¤‡ä»½ç­–ç•¥

### æ‰©å±•åŠŸèƒ½
1. **è¯¾ç¨‹å†…å®¹å­˜å‚¨**: IPFSé›†æˆå­˜å‚¨è¯¾ç¨‹ææ–™
2. **æ¨èç³»ç»Ÿ**: åŸºäºè´­ä¹°å†å²çš„è¯¾ç¨‹æ¨è
3. **ç»Ÿè®¡åˆ†æ**: è¯¾ç¨‹é”€å”®æ•°æ®åˆ†æ
4. **é€šçŸ¥ç³»ç»Ÿ**: è¯¾ç¨‹æ›´æ–°å’Œè´­ä¹°é€šçŸ¥

## ğŸ¯ å½“å‰é¡¹ç›®çŠ¶æ€

### âœ… å·²å®Œæˆ (ä¼°è®¡70%è¿›åº¦)
- **æ™ºèƒ½åˆçº¦**: å…¨éƒ¨å®Œæˆå¹¶éƒ¨ç½²
- **åç«¯API**: å…¨éƒ¨æ ¸å¿ƒåŠŸèƒ½å®Œæˆ
- **å‰ç«¯åŸºç¡€**: æ¡†æ¶æ­å»ºå’ŒAPIé›†æˆå®Œæˆ
- **æ•°æ®åº“**: è®¾è®¡å’Œå®ç°å®Œæˆ
- **æµ‹è¯•**: å®Œæ•´çš„ç³»ç»Ÿæµ‹è¯•é€šè¿‡

### ğŸš§ å¾…å®Œæˆ (ä¼°è®¡30%è¿›åº¦)
- **å‰ç«¯UIç»„ä»¶**: é¡µé¢ç»„ä»¶å¼€å‘
- **ç”¨æˆ·ä½“éªŒ**: å“åº”å¼è®¾è®¡å’Œäº¤äº’ä¼˜åŒ–
- **éƒ¨ç½²**: ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²é…ç½®

### ğŸ“ˆ æŠ€æœ¯å€ºåŠ¡
- ç­¾åéªŒè¯é€»è¾‘å®Œå–„
- é”™è¯¯å¤„ç†è¾¹ç•Œæƒ…å†µ
- ç”Ÿäº§ç¯å¢ƒå®‰å…¨åŠ å›º

---

## ğŸ† æŠ€æœ¯æˆæœæ€»ç»“

è¿™æ¬¡åç«¯å¼€å‘æˆåŠŸå®ç°äº†ï¼š

1. **ğŸ—ï¸ ç°ä»£åŒ–æŠ€æœ¯æ ˆ**: TypeScript + Express + MySQL
2. **ğŸ”— åŒºå—é“¾é›†æˆ**: æ™ºèƒ½åˆçº¦ä¸ä¼ ç»Ÿæ•°æ®åº“çš„æ··åˆæ¶æ„
3. **ğŸ“Š å®Œæ•´çš„API**: RESTfulè®¾è®¡ï¼Œæ”¯æŒæ‰€æœ‰æ ¸å¿ƒä¸šåŠ¡åŠŸèƒ½
4. **ğŸ” å®‰å…¨æœºåˆ¶**: ç­¾åéªŒè¯å’Œæƒé™æ§åˆ¶åŸºç¡€
5. **ğŸ§ª å¯é æ€§**: å®Œæ•´çš„æµ‹è¯•è¦†ç›–å’Œé”™è¯¯å¤„ç†
6. **âš¡ æ€§èƒ½ä¼˜åŒ–**: æ•°æ®åº“ç´¢å¼•å’ŒæŸ¥è¯¢ä¼˜åŒ–
7. **ğŸ”„ é™çº§ç­–ç•¥**: APIä¸åŒºå—é“¾åŒé‡æ•°æ®æºä¿éšœ

**è¿™ä¸ºWeb3æ•™è‚²å¹³å°æä¾›äº†ç¨³å®šã€å¯æ‰©å±•çš„åç«¯æ”¯æ’‘ï¼**